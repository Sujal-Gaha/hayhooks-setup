services:
  hayhooks:
    build: . 
    container_name: hayhooks
    ports:
      - "1416:1416"
    volumes:
      - ./pipelines:/pipelines
      - ./files:/files
      - chroma_data:/data/chroma_db  # Persist ChromaDB data
      - uploads:/uploads  # Optional: store uploaded files
    environment:
      - HAYHOOKS_PIPELINES_DIR=/pipelines
    env_file:
      - .env
    restart: unless-stopped

  open-webui:
    image: ghcr.io/open-webui/open-webui:${WEBUI_DOCKER_TAG-main}
    container_name: open-webui
    volumes:
      - open-webui:/app/backend/data
    ports:
      - ${OPEN_WEBUI_PORT-3000}:8080
    environment:
      - WEBUI_AUTH=false
      - OPENAI_API_BASE_URL=http://hayhooks:1416
      - OPENAI_API_KEY="dummy"
      - ENABLE_TAGS_GENERATION=false
      - ENABLE_EVALUATION_ARENA_MODELS=false
      - OFFLINE_MODE=true
    depends_on:
      - hayhooks
    restart: unless-stopped

volumes:
  open-webui:
  chroma_data:  # Persistent ChromaDB storage
  uploads:  # Persistent upload storage
